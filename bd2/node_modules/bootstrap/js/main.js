// console.log("Script main.js carregado");

const url = "https://smsfranciscobeltrao.com.br";
const urlProdutos = `${url}/produtos/`;

let inputSearch = document.getElementById("inpSearch");

function getProdutos() {
  
  localStorage.setItem('search', inputSearch.value)
  console.log("salvc")
  console.log(inputSearch.value)

  // console.log("Função getProdutos chamada");
  axios.defaults.headers.search = inputSearch.value;
  axios.defaults.headers.user = localStorage.getItem("id");
  axios
    .get(urlProdutos)
    .then((response) => {
      // console.log("Dados recebidos:", response.data);
      // console.log(response)
      const produtos = response.data;
      const produtosContainer = document.querySelector(".produtos");
      produtosContainer.innerHTML = "";

      produtos.forEach((produto) => {
        // console.log("Processando produto:", produto);
        const produtoDiv = document.createElement("div");
        produtoDiv.className =
          "produto border rounded-4 border-4 border-warning bg-dark-subtle p-3 mb-3";
        produtoDiv.style.background = `url(${produto.imagem}), rgba(255, 255, 255, 0)`;
        produtoDiv.style.backgroundSize = "contain";
        produtoDiv.style.backgroundPosition = "center";
        produtoDiv.style.backgroundRepeat = "no-repeat";
        produtoDiv.setAttribute('key', produto.codigo);

        const nome = document.createElement("h3");
        nome.textContent = produto.nome;
        produtoDiv.appendChild(nome);

        // const descricao = document.createElement("p");
        // descricao.className = 'produto-descricao';
        // descricao.key = produto.codigo;
        // descricao.textContent = produto.descricao;
        // produtoDiv.appendChild(descricao);

        const preco = document.createElement("h5");
        preco.textContent = `Preço: ${produto.valor}`;
        produtoDiv.appendChild(preco);

        produtosContainer.appendChild(produtoDiv);
      });
    })
    .catch((error) => console.error(error));
}

let btnSearch = document.getElementById("btnSearch")

btnSearch.addEventListener("click", (ev) => {
  ev.preventDefault();
  console.log(produtos)
  // let arr = {}
  // produtos.forEach(produto => {
  //   if(!produto in arr){
  //     console.log(produto)
  //   }
  // });
})

// Chama getProdutos() quando o DOM estiver completamente carregado
document.addEventListener("DOMContentLoaded", getProdutos);
inputSearch.addEventListener("input", getProdutos);

document.addEventListener('click', (event) => {
  if (event.target && (event.target.classList.contains('produto'))) {
    let key = event.target.getAttribute('key');

    localStorage.setItem('currentProduto', key);

    window.location.href = 'produto.html';
  }else if (event.target.parentElement.classList.contains('produto')) {
    let key = event.target.parentElement.getAttribute('key');

    localStorage.setItem('currentProduto', key);

    window.location.href = 'produto.html';
  }
})
