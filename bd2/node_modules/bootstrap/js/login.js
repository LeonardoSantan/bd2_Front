function postRegister() {
  const url = "https://smsfranciscobeltrao.com.br";
  const urlRegister = `${url}/pessoa/`;
  const urlLogin = `${url}/login/`;
  const nome = localStorage.getItem("nome");
  const regemail = localStorage.getItem("regemail");
  const regpass = localStorage.getItem("regpass");

  axios.post(urlLogin, {
    "user": regemail,
    "password": regpass
  })
    .then((response) => {
      let errorMessage = 'Usuário já cadastrado.';
      console.log("Displaying register error message:", errorMessage);
      displayRegisterErrorMessage(errorMessage); // Exibe erro de registro
    })
    .catch((error) => {
      const nome = localStorage.getItem("nome");
      const regemail = localStorage.getItem("regemail");
      const regpass = localStorage.getItem("regpass");

      localStorage.setItem("nome", nome);
      localStorage.setItem("regemail", regemail);
      localStorage.setItem("regpass", regpass);
      window.location.href = 'register.html';

    });
}

function displayRegisterErrorMessage(message) {
  console.log("displayRegisterErrorMessage called with message:", message);
  const errorElement = document.createElement('div');
  errorElement.id = 'error-message';
  errorElement.textContent = message;
  errorElement.style.color = 'red';
  errorElement.style.marginTop = '10px';
  errorElement.style.display = 'block';
  errorElement.style.textAlign = 'center';

  const RegisterContainer = document.querySelector('.card-back .section');
  if (RegisterContainer) {
    console.log("Register container found, appending error message");
    RegisterContainer.appendChild(errorElement);
  } else {
    console.error('Register container not found to append error message');
    // Se não encontrar o contêiner, pode ser um problema no HTML
  }
}

function displayErrorMessage(message) {
  console.log("displayErrorMessage called with message:", message);
  const errorElement = document.createElement('div');
  errorElement.id = 'error-message';
  errorElement.textContent = message;
  errorElement.style.color = 'red';
  errorElement.style.marginTop = '10px';
  errorElement.style.display = 'block';
  errorElement.style.textAlign = 'center';

  const loginContainer = document.querySelector('.card-front .section');
  if (loginContainer) {
    console.log("Login container found, appending error message");
    loginContainer.appendChild(errorElement);
  } else {
    console.error('Login container not found to append error message');
    // Se não encontrar o contêiner, pode ser um problema no HTML
  }
}

// Event listener para o botão de login
document.addEventListener("DOMContentLoaded", function () {
  const switchCheckbox = document.getElementById("reg-log");
  const botaoLogin = document.getElementById("btn-login");
  const botaoRegistrar = document.getElementById("btn-registrar");

  function salvarDados() {
    if (switchCheckbox.checked) {
      // Card de registrar está ativo
      const nome = document.getElementById("register-name").value;
      const regemail = document.getElementById("register-email").value;
      const regpass = document.getElementById("register-password").value;

      localStorage.setItem("nome", nome);
      localStorage.setItem("regemail", regemail);
      localStorage.setItem("regpass", regpass);
    } else {
      // Card de login está ativo
      const logemail = document.getElementById("login-email").value;
      const logpass = document.getElementById("login-password").value;

      localStorage.setItem("logemail", logemail);
      localStorage.setItem("logpass", logpass);
    }
  }

  if (botaoLogin) {
    botaoLogin.addEventListener("click", function (ev) {
      ev.preventDefault();
      salvarDados();
      postLogin();
    });
  }

  if (botaoRegistrar) {
    botaoRegistrar.addEventListener("click", function (ev) {
      ev.preventDefault();
      salvarDados();
      postRegister();
    });
  }
});

function removeErrorMessage() {
  const errorElement = document.getElementById('error-message');
  if (errorElement) {
    errorElement.remove();
  }
}

function postLogin() {
  const url = "https://smsfranciscobeltrao.com.br";
  const urlLogin = `${url}/login/`;

  const logemail = localStorage.getItem("logemail");
  const logpass = localStorage.getItem("logpass");

  // Remover mensagem de erro anterior, se existir
  removeErrorMessage();

  axios.post(urlLogin, {
    "user": logemail,
    "password": logpass
  })
    .then((response) => {
      if (response.status === 200) {
        const data = response.data;
        localStorage.setItem("id", data.codigo);
        window.location.href = 'main.html';
      }
    })
    .catch((error) => {
      console.error(error);
      let errorMessage = 'Erro desconhecido ao fazer login.';
      if (error.response) {
        // Erro retornado pelo servidor
        if (error.response.data && error.response.data.message) {
          errorMessage = error.response.data.message[0];
        }
      } else {
        // Outro tipo de erro
        errorMessage = 'Falha na requisição: ' + error.message;
      }
      console.log("Displaying login error message:", errorMessage);
      displayErrorMessage(errorMessage); // Exibe erro de login
    });
}
